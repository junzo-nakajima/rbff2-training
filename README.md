# リアルバウト餓狼伝説2 トレーニングモードLuaスクリプト

1998年に発売されたネオジオの対戦格闘ゲーム、餓狼伝説シリーズ7作目、リアルバウトシリーズ3作目にあたる「リアルバウト餓狼伝説2 NEW COMMERS」のトレーニングモードを実現するためのLuaスクリプトです。
このプロジェクトは *mame-rr-scripts* の実装の一部を含みます。


## スタートガイド

プロジェクトをダウンロードしてトレーニングモードを実行するまでの手順を説明します。


### 動作環境

次の環境で動作確認しています。
BIOSに関しては UNIVERSAL-BIOS 4.0 をご利用ください。

1. Windows10
2. MAME 0.227 64-bit
3. UNIVERSAL-BIOS 4.0を含む neogeo.zip
4. rbff2h.zip


### 必要条件

トレーニングモードを実行するためには、以下のものが必要になります。

 1.  本プラグインを利用できるアーケードゲームエミュレーターMAME
	Windows 10上で動作するMAME 0.222 64-bit Windows版でプラグインの開発と動作確認を行っています。
	2020年7月現在では、次のリンクからダウンロードすることができます: [MAME]

2.  リアルバウト餓狼伝説2ロムデータ
	[GOG]、 [DMM] または [Humble Bundle]で販売されている、移植ソフトからデータを取り出すことができます。
	ゲームを購入して、あなたの環境にインストールしたあと、インストールディレクトリのなかにロムデータである rbff2.zip を確認できるでしょう。
	BIOSデータである neogeo.zip も同じ場所から取り出すことができるでしょう。
	本スクリプトはAES版での動作確認を行っています。 rbff2.zip を rbff2h.zip にリネームして使用してください。

3. ネオジオのBIOSデータ
	前述のロムデータと同じく[GOG]、 [DMM] または [Humble Bundle]で販売されている、移植ソフトからデータを入手できます。
	GOGかDMMで入手できる neogeo.zip に UNIVERSAL-BIOS 4.0 を追加して利用してください。
	[UNIVERSAL-BIOS]から入手できます。

4. コマンド表示の処理でMAMEに含まれるdataプラグインを利用します。

[GOG]:https://www.gog.com/
[DMM]:https://games.dmm.com/
[Humble Bundle]:https://www.humblebundle.com/
[MAME]:https://www.mamedev.org/release.html
[UNIVERSAL-BIOS]:http://unibios.free.fr/
[ATE]:http://glorious.r.ribbon.to/pach_ATE/pach_ATE.html

### インストール方法

1. ダウンロードしたファイルを確認します。
	![ダウンロード後](https://github.com/sanwabear/rbff2training-doc/blob/master/how_to_pic/1_MAME%E3%81%A8BIOS%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E5%BE%8C.png?raw=true "ダウンロード後")
	- この手順ではMAMEのアーカイブ(`mame0222b_64bit.exe`)と`uni-bios-40.zip`を使います。
2. MAMEのインストールディレクトリを作成します。
	![ディレクトリ作成](https://github.com/sanwabear/rbff2training-doc/blob/master/how_to_pic/2_MAME%E5%85%A5%E3%82%8C%E4%BD%9C%E6%88%90.png?raw=true "ディレクトリ作成")
3. MAMEのアーカイブを解凍します。
	![解凍](https://github.com/sanwabear/rbff2training-doc/blob/master/how_to_pic/3_MAME%E8%A7%A3%E7%AD%94.png?raw=true "解凍")
	- ↓ 解凍
	![解凍後](https://github.com/sanwabear/rbff2training-doc/blob/master/how_to_pic/4_%E8%A7%A3%E5%87%8D%E3%81%8A%E3%82%8F%E3%82%8A.png?raw=true "解凍後")
4. ゲームのROMデータとBIOSデータをMAMEのromsディレクトリにコピーします。
	![ROMデータ](https://github.com/sanwabear/rbff2training-doc/blob/master/how_to_pic/5_%E3%83%AD%E3%83%A0%E3%82%B3%E3%83%94%E3%83%BC.png?raw=true "ROMデータ")
	- ↓ コピー
	![ROMデータコピー後](https://github.com/sanwabear/rbff2training-doc/blob/master/how_to_pic/6_%E3%83%AD%E3%83%A0%E3%82%B3%E3%83%94%E3%83%BC%E5%BE%8C.png?raw=true "ROMデータコピー後")
	- この手順ではDMMのインストール先ディレクトリからコピーします。
5. ダウンロードしたUNIVERSAL-BIOS 4.0のBIOSデータを`neogeo.zip`の中に含めます。
	![UNIBIOSコピー](https://github.com/sanwabear/rbff2training-doc/blob/master/how_to_pic/7_BIOS%E3%82%B3%E3%83%94%E3%83%BC.png?raw=true "UNIBIOSコピー")
	- ↓ コピー
	
	![UNIBIOSコピー後](https://github.com/sanwabear/rbff2training-doc/blob/master/how_to_pic/8_BIOS%E3%82%B3%E3%83%94%E3%83%BC%E5%BE%8C.png?raw=true "UNIBIOSコピー後")
6. 本スクリプトをダウンロードします。
	![スクリプト](https://github.com/sanwabear/rbff2training-doc/blob/master/how_to_pic/9_%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89.png?raw=true "スクリプト")
	- ↓ ダウンロード
	
	![スクリプトコピー](https://github.com/sanwabear/rbff2training-doc/blob/master/how_to_pic/10_%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%B3%E3%83%94%E3%83%BC.png?raw=true "スクリプトコピー")
	- ↓ コピー
	
	![スクリプトコピー後](https://github.com/sanwabear/rbff2training-doc/blob/master/how_to_pic/11_%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%B3%E3%83%94%E3%83%BC%E5%BE%8C.png?raw=true "スクリプトコピー後")
7. 起動バッチを作成してMAMEのディレクトリに保存します。
	![起動バッチ](https://github.com/sanwabear/rbff2training-doc/blob/master/how_to_pic/12_%E3%83%90%E3%83%83%E3%83%81%E4%BD%9C%E6%88%90.png?raw=true "起動バッチ")
	- ↓ コピペ用
	
	```BatchFile
	cd /d %~dp0
	chcp 65001
	start mame64.exe -window -debug -pause_brightness 1 rbff2h -bios unibios40 -plugin data,rbff2training
	```
	- ↓ 保存
	
	![起動バッチ保存後](https://github.com/sanwabear/rbff2training-doc/blob/master/how_to_pic/13_%E3%83%90%E3%83%83%E3%83%81%E4%BF%9D%E5%AD%98%E5%BE%8C.png?raw=true "起動バッチ保存後")
8. バッチを起動します。
	![起動後](https://github.com/sanwabear/rbff2training-doc/blob/master/how_to_pic/14_%E3%83%90%E3%83%83%E3%83%81%E5%AE%9F%E8%A1%8C%E3%81%A7%E8%B5%B7%E5%8B%95.png?raw=true "起動後")
9. Enjoy!
10. 必要に応じてコンフィグ等、実施してください。

## トレーニングモード

1. 1人用であそべます。
2. ゲームを開始します。
3. 1プレイヤーのキャラクター、2プレイヤーのキャラクターを選択します。
4. 対戦がトレーニングモード状態で開始します。
5. スタートボタンで開くメニューからオプションを選択できます。

### 画面の説明

![対戦画面](https://github.com/sanwabear/rbff2training-doc/blob/master/infos.png?raw=true "対戦画面")

* 1プレイヤーのスタン値ゲージ、2プレイヤーのスタン値ゲージ ... 通常は表示されていないスタン値を表示します。
* フレーム差表示（数値） ... 動作した最後に発生したフレーム差を表示します。お互い五分の状態では更新されません。ニュートラルポーズでフレーム差を計算しているため、継続して動作していると値が増え続けます。
* フレーム差表示（グラフ） ... 行動ごとに区切ったフレーム状態をグラフ表示し続けます。有利フレーム、不利フレームを数値で表示します。青色が有利、赤色が不利となります。薄い黄色がガードに移行できない行動中、数値のない赤色が攻撃判定出現中、グレーがヒットストップ中、薄い水色は無敵中となります。
* 1プレイヤーのコンボダメージ、2プレイヤーのコンボダメージ ... コンボダメージの合計値、括弧の中は直前に加算したダメージ、コンボ数を表示します。隣に最大ダメージ、最大コンボ数を表示します。
* 1プレイヤーの入力表示、2プレイヤーの入力表示 ... レバーとボタンの入力と入力フレーム数の記録です。
* 1プレイヤーのフレーム表示、2プレイヤーのフレーム表示 ... 行動ごとに区切ったフレーム状態をグラフ表示し続けます。薄い黄色がガードに移行できない行動中、数値のない赤色が攻撃判定出現中、グレーがヒットストップ中です。ずれて表示する青色が有利フレーム、赤色が不利フレームとなります。さらにずれて表示する薄い水色は無敵中となります。
* プレイヤー間の距離表示 ... 1プレイヤーと2プレイヤーのキャラクター間の中心点の距離数（ドット数）です。


### メニューの操作方法

1. スタートボタンでメニューを開くことができます。セレクトボタンによるポーズ中はメニューを開けません。
2. レバー上下で項目を選択、◀または▶がある項目ではレバー右とレバー左でオプションを選択できます。
3. Aボタンで確定、Bボタンで離脱し、メニューの移動か対戦画面に戻ることができます。

#### トップメニュー
![トップメニュー](https://github.com/sanwabear/rbff2training-doc/blob/master/menu1.png?raw=true "トップメニュー")

* トレーニングオプション ... Aボタンでトレーニングオプションメニューへ移動します。
* プレイヤーセレクト画面 ... Aボタンでプレイヤーセレクト画面へ戻ります。
* 1P セレクト、2P セレクト ... レバー左右でキャラクターを選択し、Aボタンでメニューの選択内容で2対戦をリスタートします。
* 1P カラー、2P カラー ... レバー左右でキャラクターのカラーを選択し、Aボタンでメニューの選択内容で対戦をリスタートします。
* ステージセレクト ... レバー左右でステージを選択し、Aボタンでメニューの選択内容で対戦をリスタートします。
* BGMセレクト ... レバー左右でBGMを選択し、Aボタンでメニューの選択内容で対戦をリスタートします。
* リスタート ... Aボタンでメニューの選択内容で対戦をリスタートします。


#### トレーニングオプションメニュー(1)
![トレーニングオプションメニュー](https://github.com/sanwabear/rbff2training-doc/blob/master/menu2.png?raw=true "トレーニングオプションメニュー")

* ダミーモード
	+ プレイヤー vs プレイヤー ... 通常のトレーニング状態です。それぞれのプレイヤー側で操作するか、ダミー設定の行動をとらせることができます。
    + プレイヤー vs CPU ... 2プレイヤー側のキャラクターをCPUが操作します。
    + CPU vs プレイヤー ... 1プレイヤー側のキャラクターをCPUが操作します。
    + 1P&2P入れ替え ... 1プレイヤー側の操作で2プレイヤー側のキャラクターを、2プレイヤー側の操作で1プレイヤー側のキャラクターを操作できます。
    + レコード ... Aボタンでレコードメニューへ移動します。
    + リプレイ ... Aボタンでリプレイメニューへ移動します。
    
* 1P アクション、2P アクション ... ダミーの基本的な状態を選択します。
	+ 立ち ... ニュートラルの立ち状態になります。
    + しゃがみ ... ニュートラルのしゃがみ状態になります。
    + ジャンプ ... 垂直ジャンプを続けます。
    + 小ジャンプ ... 垂直小ジャンプを続けます。
    + スウェー待機 ... スウェー上でレバー上入力をし続けた状態になります。
* 1P ガード、2P ガード ... 自動ガードの行動を選択します。ガード時のフレーム差異を確認する場合は「1ガード」で「1ガード持続フレーム数」を調整してください。
	+ なし ... 攻撃に対してなにもしません。
    + オート ... 上段、中段、下段でガード行動を切り替えます。
    + 1ヒットガード ... 初段ヒット後、オートと同等のガード行動でガードし続けます。約1.5秒の間、何もなければ初段ヒット状態に戻ります。
    + 1ガード ... 初段を1回オートと同等のガード行動でガードしたのち、約1.5秒の間か攻撃ヒットまで無防備状態になります。ガード行動の継続フレームは「1ガード持続フレーム数」で選択した数値となります。「1ガード持続フレーム数」を越えた場合に前進してフレーム差を確認できるようにしています。
    + 常時 ... アクションで選択した状態でガード行動をとります。
    + ランダム ... ランダムでオートと同等のガード行動を行います。
* 1ガード持続フレーム数 ... ガードの設定で「1ガード」を選択した場合のガード行動の持続フレーム数をレバー左右で設定します。
* 1P やられ時行動、2P やられ時行動 ... やられ～ダウンした場合の動作を選択します。
	+ なし ... なにもしません。
    + テクニカルライズ ... テクニカルライズでダウンから復帰します。
    + グランドスウェー ... グランドスウェーでダウンから復帰します。
* 1P 挑発で前進、2P 挑発で前進 ... ONにすると挑発でダミーを前進させることができます。


#### レコードメニュー
![レコードメニュー](https://github.com/sanwabear/rbff2training-doc/blob/master/menu5.png?raw=true "レコードメニュー")

+ 各スロットの上でAボタンを押すと、対戦画面に戻り、そのスロットに対してのレコードを開始します。
+ 既にスロットに記録されていたレコードは新しく上書きされます。

#### リプレイメニュー
![リプレイメニュー](https://github.com/sanwabear/rbff2training-doc/blob/master/menu6.png?raw=true "リプレイメニュー")

+ 各メニューでAボタンを押すと、対戦画面に戻り、リプレイまちとなります。
+ スタートボタンでONにしたスロットの内容をリプレイします。
+ 繰り返し設定がONの場合は、再度スタートボタンを押すか、ダミーが攻撃を受けるまでリプレイを繰り返します。
+ 間合い固定がONの場合は、「開始間合い」でレコードした間合い、画面位置に強制的に移動した状態からリプレイを行います。
+ リプレイ状態からはスタートボタン押しっぱなしでメニューを表示して抜けることができます。


#### トレーニングオプションメニュー(2)
![トレーニングオプションメニュー](https://github.com/sanwabear/rbff2training-doc/blob/master/menu3.png?raw=true "トレーニングオプションメニュー")

* 1P 体力ゲージ、2P 体力ゲージ ... 通常の100％か、赤の50％の体力状態を選択できます。
* 1P POWゲージ、2P POWゲージ ... 無限の場合の常に100％となり、通常では通常のゲージ運用となります。


#### トレーニングオプションメニュー(3)
![トレーニングオプションメニュー](https://github.com/sanwabear/rbff2training-doc/blob/master/menu4.png?raw=true "トレーニングオプションメニュー")

* 判定表示
* ヒット時にポーズ ... ONの場合、ヒットした瞬間にMAMEのポーズ状態にします。MAMEのポーズ解除操作（デフォルト設定では`P`キー）でトレーニングに戻ります。例えば判定ギリギリでヒットする位置関係を確認するために用意しています。
* 投げ判定発生時にポーズ ... ONの場合、投げ判定の発生の瞬間にMAMEのポーズ状態にします。MAMEのポーズ解除操作（デフォルト設定では`P`キー）でトレーニングに戻ります。1フレーム～数フレームしかない投げ判定の発生の瞬間を確認するために用意しています。
* 1P ダメージ表示、2P ダメージ表示 ... ONの場合、コンボダメージの表示を有効にします。
* 1P 入力表示、2P 入力表示  ... ONの場合、入力表示を有効にします。
* フレーム差表示 ... ONの場合、フレーム差表示（グラフと数値の両方）を有効にします。
* 1P フレーム数表示、2P フレーム数表示 ... ONの場合、フレーム表示を有効にします。
* スタン表示 ... ONの場合、スタン値ゲージ表示を有効にします。
* 1P 2P 距離表示 ... ONの場合、プレイヤー間の距離表示を有効にします。
* 簡易超必 ... ↓↓+A  による超必殺技、↓↓+C による潜在能力の発動を有効にします。一部の複数の超必殺技、潜在能力を所持するキャラクターは↓↓+B または ↓↓+D でそれらを発動できます。


## 著者

 Jesuszilla が開発した mame-rr-scripts から次のスクリプトを複製、改造して取り込んでいます。
 * fighting-OSD.lua
 * garou-hitboxes.lua
 * scrolling-input-display.lua

その他のスクリプトは@ym2601 (https://github.com/sanwabear)が開発しました。


## ライセンス

このプロジェクトは MITライセンスの元にライセンスされています。 
詳細は LICENSE.md をご覧ください。


## 謝辞

ネオジオ オンラインコレクション 餓狼伝説バトルアーカイブズ2 のトレーニングモードに着想を得ました。
またその他の格闘ゲームのトレーニングモードを使用した経験からのアイデアも含んでいます。

レコーディング、リプレイ機能に関しては、ストリートファイター3rdストライクプレイヤーであるクロダ氏のトレーニングモードの動画からの影響もうけています。 
クロダ氏の動画は https://www.twitch.tv/kuroda236 で視聴することができます。
Youtubeでもクロダ氏の名前で検索すれば多くの動画を見つけることができでしょう。
迅速なレコーディング、リプレイを実現することが残っている課題の一つです。

mame-rr-scripts のすばらしいスクリプトの数々がなければ、このプロジェクトは存在しませんでした。
特にヒットボックスの表示と、OSDの表示については、プログラムコード解析の技術に劣る私にはできない仕事です。
素晴らしい仕事をありがとうございます。

MAMEプロジェクト、FBAプロジェクト、各種チート、IPSパッチの開発者に感謝いたします。

リアルバウト餓狼伝説2の攻略サイトの情報がトレーニングのモチベーションを維持するのに役立ちました。
次のリンクから素晴らしい情報を見ることができます: http://gitr.web.fc2.com/

最後に、リアルバウト餓狼伝説2および餓狼伝説シリーズの開発者に感謝いたします。
